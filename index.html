useEffect(() => {
    const init = async () => {
        await fetchAllData();
        
        // ตรวจสอบและสร้าง admin config ถ้ายังไม่มี
        const adminDoc = await window.fb.getDoc(window.fb.doc(window.db, "config", "admin"));
        if (!adminDoc.exists()) {
            await window.fb.setDoc(window.fb.doc(window.db, "config", "admin"), { 
                password: "admin1234" 
            });
        }
        
        // ตรวจสอบและสร้าง system config ถ้ายังไม่มี
        const systemDoc = await window.fb.getDoc(window.fb.doc(window.db, "config", "system"));
        if (!systemDoc.exists()) {
            await window.fb.setDoc(window.fb.doc(window.db, "config", "system"), {
                activeSubjectId: '',
                activeExamSetId: 1,
                isOpen: false,
                customTimeLimit: 0,
                activeClassroom: 'All',
                examOpenedAt: '',
                examStartMs: 0,
                roomPassword: ''
            });
        }
    };
    
    init();
    
    const unsubConfig = window.fb.onSnapshot(
        window.fb.doc(window.db, "config", "system"), 
        (doc) => {
            if (doc.exists()) {
                console.log('Config updated:', doc.data());
                setSystemConfig(doc.data());
            }
        }
    );
    
    const unsubAdmin = window.fb.onSnapshot(
        window.fb.doc(window.db, "config", "admin"), 
        (doc) => {
            if (doc.exists()) setAdminGlobalPassword(doc.data().password);
        }
    );
    
    unsubscribers.current.push(unsubConfig, unsubAdmin);
    
    return () => {
        cleanupListeners();
    };
}, []);
